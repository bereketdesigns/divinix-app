---
import jsonwebtoken from 'jsonwebtoken';

const JWT_SECRET = import.meta.env.JWT_SECRET;
const token = Astro.cookies.get('auth_token')?.value;
let isLoggedIn = false;

if (token && JWT_SECRET) {
  try {
    jsonwebtoken.verify(token, JWT_SECRET);
    isLoggedIn = true;
  } catch (error) {
    isLoggedIn = false;
    Astro.cookies.delete('auth_token', { path: '/' });
  }
}

if (isLoggedIn) {
  return Astro.redirect('/edit');
} else {
  return Astro.redirect('/discover');
}
---
<!-- This page is a router and has no visible content. -->